{{ $externalURL := .externalURL -}}
{{ $alerts := .alerts -}}
{{ $grafanaURL := "http://grafana.taicang.local/d/3pdYh_eIk/node-exporter-nodes?orgId=1&refresh=30s" -}}
{{ range $alert := $alerts -}}
  {{ $groupKey := printf "%s|%s" $alert.labels.alertname $alert.status -}}
  {{ $urimsg := "" -}}
  {{ range $key,$value := $alert.labels -}}
    {{ $urimsg = print $urimsg $key "%3D%22" $value "%22%2C" -}}
  {{ end -}}

  {{ $namespace := $alert.labels.namespace -}}
  {{ $instance := "" -}}
  {{ $controllerType := "" -}}

  {{ if $alert.labels.deployment -}}
    {{ $instance = $alert.labels.deployment -}}
    {{ $controllerType = "deployments" -}}
  {{ else if $alert.labels.daemonset -}}
    {{ $instance = $alert.labels.daemonset -}}
    {{ $controllerType = "daemonsets" -}}
  {{ else if $alert.labels.statefulset -}}
    {{ $instance = $alert.labels.statefulset -}}
    {{ $controllerType = "statefulsets" -}}
  {{ else if $alert.labels.pod -}}
    {{ $instance = $alert.labels.pod -}}
    {{ $controllerType = "pods" -}}
  {{ end -}}

  {{ $kubesphereURL := printf "http://kubesphere.taicang.local/clusters/default/projects/%s/%s/%s/resource-status" $namespace $controllerType $instance -}}

  {{ if eq $alert.status "resolved" -}}
Kubernetes é›†ç¾¤æ¢å¤é€šçŸ¥
ğŸŸ¡ã€å‘Šè­¦åç§°ã€‘{{ $alert.labels.alertname }} 
ğŸš¨ã€å‘Šè­¦çº§åˆ«ã€‘{{ $alert.labels.severity }} 
âœ…ã€å‘Šè­¦çŠ¶æ€ã€‘{{ $alert.status }} 
ğŸ§­ã€å¼€å§‹æ—¶é—´ã€‘{{ GetCSTtime $alert.startsAt }} 
ğŸ§­ã€ç»“æŸæ—¶é—´ã€‘{{ GetCSTtime $alert.endsAt }} 
ğŸ·ï¸ã€å‘½åç©ºé—´ã€‘{{ $alert.labels.namespace }} 
ğŸ“¡ã€å®ä¾‹åç§°ã€‘{{ $alert.labels.host }}{{ $alert.labels.pod }}{{ $instance }} 
ğŸ”„ã€å®ä¾‹æ§åˆ¶å™¨ç±»å‹ã€‘{{ $controllerType | title }}
ğŸ“ã€å‘Šè­¦è¯¦æƒ…ã€‘{{ $alert.annotations.message }}{{ $alert.annotations.description }};{{ $alert.annotations.summary }}

[*** ç‚¹æˆ‘å±è”½è¯¥å‘Šè­¦]({{$externalURL}}/#/silences/new?filter=%7B{{SplitString $urimsg 0 -3}}%7D)
[*** ç‚¹å‡»æˆ‘æŸ¥çœ‹ Grafana ç›‘æ§é¢æ¿]({{$grafanaURL}})
[*** ç‚¹å‡»æˆ‘æŸ¥çœ‹ KubeSphere æ§åˆ¶å°]({{$kubesphereURL}})
  {{ else -}}
Kubernetes é›†ç¾¤å‘Šè­¦é€šçŸ¥
ğŸŸ¡ã€å‘Šè­¦åç§°ã€‘{{ $alert.labels.alertname }} 
ğŸš¨ã€å‘Šè­¦çº§åˆ«ã€‘{{ $alert.labels.severity }} 
ğŸ”¥ã€å‘Šè­¦çŠ¶æ€ã€‘{{ $alert.status }} 
ğŸ§­ã€å¼€å§‹æ—¶é—´ã€‘{{ GetCSTtime $alert.startsAt }} 
ğŸ·ï¸ã€å‘½åç©ºé—´ã€‘{{ $alert.labels.namespace }} 
ğŸ“¡ã€å®ä¾‹åç§°ã€‘{{ $alert.labels.host }}{{ $alert.labels.pod }}{{ $instance }} 
ğŸ”„ã€å®ä¾‹æ§åˆ¶å™¨ç±»å‹ã€‘{{ $controllerType | title }}
ğŸ“ã€å‘Šè­¦è¯¦æƒ…ã€‘{{ $alert.annotations.message }}{{ $alert.annotations.description }};{{ $alert.annotations.summary }}

[*** ç‚¹æˆ‘å±è”½è¯¥å‘Šè­¦]({{$externalURL}}/#/silences/new?filter=%7B{{SplitString $urimsg 0 -3}}%7D)
[*** ç‚¹å‡»æˆ‘æŸ¥çœ‹ Grafana ç›‘æ§é¢æ¿]({{$grafanaURL}})
[*** ç‚¹å‡»æˆ‘æŸ¥çœ‹ KubeSphere æ§åˆ¶å°]({{$kubesphereURL}})
  {{ end -}}
{{ end -}}
